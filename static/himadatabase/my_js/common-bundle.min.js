/**
 * Created by Administrator on 2016/5/17 0017.
 */
"undefined"==typeof WDL&&(window.WDL={}),WDL.ajaxRetry=function(e){"use strict";return e.dataType=e.dataType||"json",e.tries=0,e.timeout=e.timeout||15e3,e.retryLimit=e.retryLimit||3,e.error=function(e,t){(e.status>=500||"timeout"==t)&&this.tries++<=this.retryLimit&&jQuery.ajax(this)},jQuery.ajax(e)},WDL.getUsableViewportHeight=function(){"use strict";var e=0;return jQuery("#page-header, body > .breadcrumb").each(function(){e+=jQuery(this).outerHeight(!0)}),"none"!=jQuery(".navbar-static-bottom .navbar-nav > li").css("float")&&(e+=jQuery("#page-footer").outerHeight(!0)),jQuery(window).height()-e},WDL.getOverflowScrollbarWidth=function(){"use strict";var e=document.createElement("div");e.style.position="absolute",e.style.height="50px",e.style.width="50px",e.style.top="-150px",e.style.left="-150px",e.style.overflowY="scroll",document.body.appendChild(e);var t=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),t},"undefined"==typeof WDL.URI&&(WDL.URI={}),WDL.URI.expandTemplate=function(e,t){"use strict";var r=/{([^}]+)}/g;return e.replace(r,function(e,r){return encodeURIComponent(t[r])||""})},WDL.arrayShuffle=function(e){"use strict";for(var t=e.length-1;t>0;t--){var r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e},function(e){"use strict";function t(){i.css("min-height",r.height()-(a.height()+50))}var r=e(window),i=e("#page-main"),a=e("#page-header");r.on("resize",t),t()}(jQuery),function(e){"use strict";WDL.extendQueryString=function(t,r){var i=e.extend(e.deparam(t),r);return e.param(i).replace("=&","&")}}(jQuery),function(e){"use strict";var t=e.extend(e.deparam(document.location.search),e.deparam(document.location.hash));e.each(t,function(e){0===e.search(/^(utm|group|page|center|zoom|view)/)&&delete t[e]});var r=e.param(t,!0);r&&e(".item-detail-nav a").each(function(e,t){t.href=t.href.replace(/[?#].*$/,"")+"#"+r})}(jQuery),jQuery(function(e){"use strict";e('a[href^="http"]:not([href*="wdl.org/"])').add("a.download,a[download]").on("click",function(t){var r=e(this),i=this.href,a={transport:"beacon"};return ga("send","event","outbound","click",i,a),t.metaKey||t.ctrlKey||t.shiftKey||r.attr("target")?!0:(t.preventDefault(),window.setTimeout(function(){document.location.href=i},100),!1)}),e("#site-search select[name=qla]").change(function(){e(this).parents("form").find("input[name=q]").attr("lang",this.value)})}),function(e){"use strict";e("#share-toolbar a.share").on("click",function(t){var r=e(t.delegateTarget),i=r.data("service"),a=r.data("action")||"share",n=document.location.href.replace(/[?#].*/,"");ga("send",{hitType:"social",socialNetwork:i,socialAction:a,socialTarget:n,transport:"beacon"})})}(jQuery),function(e){"use strict";e("#language-selector a").on("click",function(){var t=e(this).parent().attr("lang");ga("send",{hitType:"event",eventCategory:"Site Language",eventAction:"change",eventValue:t,transport:"beacon"})})}(jQuery),function(e){"use strict";function t(){var t,r;if("chrome"in window&&e.isFunction(window.chrome.loadTimes)){var i=window.chrome.loadTimes();if(t=i.firstPaintTime-i.startLoadTime,t>3600)return void Raven.captureMessage("chrome.loadTimes() reported impossible values",{extra:{loadTimes:i}});t=Math.round(1e3*t),r="chrome.loadTimes"}else if("performance"in window){var a=window.performance.timing;if(0===a.navigationStart)return;t=a.msFirstPaint-a.navigationStart,r="msFirstPaint"}"number"==typeof t&&t>0&&ga("send",{hitType:"timing",transport:"beacon",timingCategory:"RUM",timingVar:"First Paint (ms)",timingValue:t,timingLabel:r})}e(window).on("load",function(){setTimeout(t)})}(jQuery),function(e){"use strict";e("#similar-items").length>0&&WDL.ajaxRetry({url:"similar-items.json",dataType:"json",cache:!0,success:function(t){if(!(t.length<1)){for(var r=e("#similar-items"),i=0;i<t.length;i++){var a=t[i],n=e('<li class="list-group-item"></li>').appendTo(r);e("<a>").appendTo(n).attr("href",a.item).append(e('<p class="title"></p>').text(a.title)).prepend(e("<img>").attr({alt:a.title,title:a.title,src:a.thumbnail,width:64,height:53}))}e("#similar-items-panel").removeClass("hidden")}}})}(jQuery),jQuery(function(e){"use strict";e(".item-detail").length<1||e("#content-search").submit(function(t){t.preventDefault();var r=this.action;return r+=(this.action.indexOf("#")>-1?"&":"#")+e(this).serialize(),document.location.href=r,!1})}),jQuery(function(e){"use strict";function t(e,t){var r=l.scrollLeft,i=0>t&&0===r,a=t>0&&r>=l.scrollWidth-l.clientWidth;e.cancelable&&(i||a)&&e.preventDefault(),e.stopPropagation(),a?m():i&&g()}function r(t,r,i){var a=t.clone();return a.attr("data-wdl-id",r),a.find("img").attr("src",f.replace("{wdl_id}",r)),a.find(".caption").text(i),e("<a>").attr({href:p.replace("{wdl_id}",r),title:i}).append(a.children().detach()).appendTo(a),a}function i(){var e=0,t=d.data("focus");switch(t){case"start":e=0;break;case"end":e=u.get(0).scrollWidth;break;default:e=h.offset().left-(u.width()/2-h.width()/2)}e=Math.max(0,e),u.scrollLeft(e)}function a(e){if(!e.previousItems&&!e.nextItems)return void d.css("max-height","0");d.css("max-height","256px");var t=u.children(".current"),a=t.clone().removeClass("current");a.find(".caret").remove(),a.find("img").attr("src","");var n,o,s=u.children("[data-wdl-id="+e.wdl_id+"]").get(0);if((!e.nextItems||e.nextItems.length<10)&&u.find(".next-page").hide(),e.nextItems)for(n=e.nextItems.length-1;n>=0;n--)o=e.nextItems[n],u.children("[data-wdl-id="+o.wdl_id+"]").length<1&&r(a,o.wdl_id,o.title).insertAfter(s);if((!e.previousItems||e.previousItems.length<10)&&u.find(".previous-page").hide(),e.previousItems)for(n=0;n<e.previousItems.length;n++)o=e.previousItems[n],u.children("[data-wdl-id="+o.wdl_id+"]").length<1&&r(a,o.wdl_id,o.title).insertBefore(s);i()}function n(t){var r=[];if(t.highlighted&&e.merge(r,e.map(t.highlighted,function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")})),s.q){var i=s.q.match(/("[^"]*"|\S+)/g);i=e.map(i,function(e){return e.replace(/(^"|"$)/g,"")}),e.merge(r,i)}if(r=e.map(r,function(e){return e.length<3||"-"==e[0]?void 0:e}),r.length>0){r=r.sort(function(e,t){return t.length-e.length});var a=new RegExp("("+r.join("|")+")","gi");e("#content-top,#metadata").children(":not(.skip-search-highlighting)").find(":not(:empty)").contents().filter(function(){return 3==this.nodeType}).each(function(t,r){var i=r.data,n=!1;i=i.replace(a,function(t){return n=!0,e("<div>").append(e("<span>").addClass("highlighted").text(t)).html()}),n&&e(r).replaceWith(i)})}}function o(t){e.ajax({url:t,data:c,dataType:"json",cache:!0}).success(function(e){if(e){try{a(e)}catch(t){Raven.captureException(t)}try{n(e)}catch(t){Raven.captureException(t)}}})}if(!(e(".item-detail").length<1)){var s,c;if(s=e.extend(e.deparam(document.location.search),e.deparam(document.location.hash)),e.each(s,function(e,t){0!==e.indexOf("utm")&&0!==e.indexOf("group")&&0!==e.indexOf("page")&&0!==e.indexOf("view")&&0!==e.indexOf("loclr")&&t||delete s[e]}),c=e.param(s,!0)){s.q&&e("input[type=search]").val(s.q),e("a.item-view").each(function(e,t){t.href+=(t.href.indexOf("#")>-1?"&":"#")+c});var d=e("#item-search-navigation").removeAttr("hidden"),u=d.children(".items").first(),l=u.get(0),h=u.children(".current"),p=d.data("item-url")+"#"+c,f=d.data("thumbnail-url").replace(/{(height|width)}/g,"192"),m=e.throttle(1e3,!0,function(){d.find(".next-page:visible button").trigger("click")}),g=e.throttle(1e3,!0,function(){d.find(".previous-page:visible button").trigger("click")});d.find("img[data-src]").each(function(e,t){t.src=t.getAttribute("data-src")}),d.find(".search-results-nav a").each(function(e,t){t.href=t.href.replace(/\?.*$/,"")+"?"+c}),o(ITEM_SEARCH_API_URL),d.find(".next-page, .previous-page").find("button").on("click",function(){var t,r=e(this),i=r.parent();return 0===i.index()?(d.data("focus","start"),t=u.children(".item").first().data("wdl-id")):(d.data("focus","end"),t=u.children(".item").last().data("wdl-id")),o(ITEM_SEARCH_API_URL.replace(e(document.body).data("wdl-id"),t)),!1}),l.addEventListener&&(l.addEventListener("wheel",function(e){return t(e,e.deltaX)}),l.addEventListener("mousewheel",function(e){var r=e.wheelDeltaX;return e.webkitDirectionInvertedFromDevice&&(r*=-1),t(e,r)}))}}}),jQuery("#item-map").on("map-ready",function(){"use strict";WDL.ajaxRetry({url:"nearest-items.json",data:{limit:25},dataType:"json",cache:!0,success:function(e){var t=WDL.Maps.newClusterGroup(),r=L.geoJson(e,{pointToLayer:function(e,t){return L.circleMarker(t,{radius:6,fillColor:"#2981CA",color:"#2E6C98",weight:1,opacity:1,fillOpacity:.6})},onEachFeature:function(e,t){e.properties&&e.properties.title&&WDL.Maps.createItemPopup(t,e.properties)}}).addTo(t);r.on("mouseover",function(e){e.layer.openPopup()}),ItemMap.layerControl&&ItemMap.layerControl.addOverlay(t,gettext("Nearby Items")),WDL.Maps.fitBounds(ItemMap,{maxZoom:3})}})}),function(e){"use strict";function t(){var e=i.parents(".media-container").first(),t=e.find("object").detach();navigator.userAgent.indexOf("MSIE")>=0&&t.attr("classid","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"),e.empty().append(t)}if(!e(document.body).is(".item-detail.viewer-video,.item-detail.viewer-audio"))return!1;var r=document.getElementById("player"),i=e(r);i.on("loadedmetadata",function(){r.videoWidth&&(r.width=r.videoWidth,r.height=r.videoHeight)}),e("#viewer img").on("click",function(){return r.paused?r.play():r.pause(),!1}),e("audio,video,source").on("error",function(){r.networkState==HTMLMediaElement.NETWORK_NO_SOURCE&&t()}),Modernizr.video||t()}(jQuery),WDL.Search=function(){"use strict";function e(e,t){var r=e.toLocaleLowerCase();return r.indexOf(t)>-1}function t(t,r){for(var i=0;i<r.length;i++)if(e(t,r[i]))return!0;return!1}function r(e){return e.toFixed(2).toString()}function i(e){return Math.round(100*e).toString()+"%"}return{matchesTerm:e,inTerms:t,formatCoord:r,formatPercentage:i}}(),WDL.ItemSearchController=function(e){"use strict";function t(t,r,i){var a=this;this.config=i,this.widget=jQuery(t),this.viewer=r,this.query="",this.results=[],this.currentResult=-1,this.inputControl=e('<input type="search">').attr("placeholder",interpolate(gettext("Search inside this item in %(language)s:"),{language:i.searchLanguageName},!0)).attr("lang",i.searchLanguageCode).val(this.query).on("keydown",function(t){t.stopPropagation(),13==t.which&&e(this).trigger("change")}).on("change",function(){a.setQuery(this.value),e(this).blur()}),this.nextButton=e('<button type="button" class="next"></button>').append(e('<span class="title">').text(gettext("Next"))).append(e('<span class="fa fa-chevron-circle-right"></span>')).on("click",e.proxy(function(){this.currentResult<this.results.length?this.currentResult+=1:this.currentResult=0;var e=this.results[this.currentResult];e&&r.trigger("goto-page",[e[0],e[1]]);var t=this.results[this.currentResult+1%this.results.length];return t&&r.trigger("prefetch-page",[t[0],t[1]]),!1},this)),this.previousButton=e('<button type="button" class="previous"></button>').append(e('<span class="fa fa-chevron-circle-left"></span>')).append(e('<span class="title">').text(gettext("Previous"))).on("click",e.proxy(function(){this.currentResult>0?this.currentResult-=1:this.currentResult=this.results.length-1;var e=this.results[this.currentResult];if(e&&r.trigger("goto-page",[e[0],e[1]]),this.currentResult>0){var t=this.results[this.currentResult-1];r.trigger("prefetch-page",[t[0],t[1]])}return!1},this)),this.widget.append(this.previousButton).append(e("<label>").append(this.inputControl)).append('<label class="result-count" hidden></label>').append(this.nextButton)}return e.extend(t.prototype,{setQuery:function(t){t=e.trim(t),t!=this.query&&(this.query=t,this.inputControl.val(this.query),this.loadSearchResultPageList(),this.processTerms())},processTerms:function(){var t=[this.query.toLocaleLowerCase()];e.merge(t,e.map(t[0].split(/\s/),function(t){return e.merge(t,e.map(t.split(/b/),e.trim))})),this.terms=e.grep(t,function(t){return e.trim(t).length>0})},loadSearchResultPageList:function(){return this.config.matchingPagesUrl&&this.query?void WDL.ajaxRetry({url:this.config.matchingPagesUrl,dataType:"json",data:{q:this.query,qla:this.config.searchLanguageCode}}).success(e.proxy(function(e){this.results=e,this.currentResult=-1;for(var t=this.viewer.data("group"),r=this.viewer.data("index"),i=0;i<e.length;i++){var a=e[i];a[0]<=t&&a[1]<=r&&(this.currentResult=i)}this.widget.find(".result-count").removeAttr("hidden").text(e.length+" pages"),this.viewer.trigger("search-query-changed",[this.query])},this)):void(this.results=[])}}),t}(jQuery),jQuery(function(e){"use strict";function t(e){return function(t,r){return WDL.Search.matchesTerm(r,e)?t:void 0}}function r(t){t!=m&&(m=t,document.location.hash=WDL.extendQueryString(document.location.hash,{view:t}),p.data("mode",t).removeClass("list gallery map").addClass(t),"map"==m?(e("#map").show(),a()):(e("#map").hide(),b.hide()),c.trigger("resize"),c.trigger("scroll"),e("#search-filters").find("a[href]:not(.remove)").each(function(){var e=this.href,r=e.indexOf("#");0>r?e+="#view="+t:e=e.substring(0,r)+"#"+WDL.extendQueryString(e.substring(r),{view:t}),this.href=e}))}function i(){var t=e('<div id="map" class="map-container"></div>');t.data({displayLayerControl:!1,delayScrollCapture:!0}).insertBefore(p),o=WDL.Maps.createMap(t.get(0)),o.setView([15,WDL.Maps.guessLongitude()],2,{reset:!0,animate:!1}),s=WDL.Maps.newClusterGroup(),WDL.Maps.addLayer(o,s,{title:gettext("Items")}),b.insertAfter(t)}function a(){o||i(),h.find("[itemprop=geo]:not(.mapped)").each(function(t,r){var i=e(r).addClass("mapped"),a=i.find('[itemprop="latitude"]').attr("content"),n=i.find('[itemprop="longitude"]').attr("content"),o=i.parents(".body").find("a.title").first(),c=e.trim(o.text()),d=document.createElement("a");d.href=o.attr("href");var u=document.createElement("img");u.src=i.parents(".result").find("img.thumbnail").attr("src"),d.appendChild(u);var l=document.createElement("span");l.appendChild(document.createTextNode(c)),d.appendChild(l),L.marker([a,n],{title:c}).bindPopup(d).addTo(s)});var t=h.find(".result").not(":has([itemprop=geo])").length;if(t){var r=ngettext("%s item without map coordinates is not visible","%s items without map coordinates are not visible",t);b.text(interpolate(r,[t])).show()}w&&s&&s.getLayers().length<7*y&&n()}function n(){if(w&&!x){x=!0,v++;var t=e.param(e.extend({},g,{page:v}),!0);e("<div>").load("?"+t+" #search-results",function(t,r,i){if(x=!1,"success"==r){var a=e(this);a.find(".result").appendTo(p).find(".doc.file").each(C),a.find(".pager .next.disabled").length>0&&(w=!1)}else 404==i.status&&(w=!1,f.hide());f.find(".next").toggleClass("disabled",!w),c.trigger("SearchResultsLoaded")})}}if(e("body").hasClass("search-results")){var o,s,c=e(window),d=e(document),u=e("#view-controls"),l=u.find("input[name=view-mode]"),h=e("#search-results").first(),p=h.children(".results").first(),f=h.find(".pager"),m=l.filter(":checked").val()||"list",g=e.deparam(document.location.search),v=g.page||g.search_page||1,y=h.data("page-size")||21,w=h.length>0&&p.children("div").length>=y,x=!1,b=e('<div class="alert alert-info"></div>').hide();g.search_page&&delete g.search_page,l.on("change",function(){r(this.value)}),e("#view-mode-toggle").on("click",".btn",function(e){var t=e.target.querySelector("input[name=view-mode]");t&&t.value&&r(t.value)}),f.on("click",".disabled a",function(){return!1}).on("click","a",function(){return n(),!1}),u.removeClass("hidden"),c.on("scroll touchmove",function(){if(w&&!x&&"map"!=m){var e=(c.height()+c.scrollTop())/d.height();e>.5&&n()}}),e(".results").on("click","a",function(){var t=e(this).parents(".result").attr("id");if(t){var r="#"+t;m&&"list"!=l.filter(":checked").val()&&(r+="&view="+m),window.history&&window.history.replaceState?window.history.replaceState({},null,r):window.location.hash=r}}),e(function(){function e(){var t=document.getElementById(r);t?(window.location.hash="",window.location.hash="#"+r,c.off("SearchResultsLoaded",e)):n()}var t=document.location.hash.match(/^#([0-9]+)/);if(t){var r=t[1];c.on("SearchResultsLoaded",e),c.trigger("SearchResultsLoaded")}}),c.on("ready SearchResultsLoaded",function(){e(".enable-search-map-view .results [itemprop=geo]").length>0&&u.find("label[hidden]:has([name=view-mode][value=map])").removeAttr("hidden"),"map"==m&&a()});var C=function(r,i){var a=e(i),n=a.parents(".result").data("wdl-id"),o=a.data("group"),s=a.data("index"),c=a.data("image-timestamp"),d="/"+LANGUAGE_CODE+"/item/"+n+"/content/"+o+"/"+s+"/word-coordinates.json";e.get(d).success(function(r){a.find(".snippet").first().each(function(i,d){function u(e,t){return Math.max(t[1],t[3])-Math.max(e[1],e[3])}for(var l=e(d),h=l.find("em").map(function(){return e(this).text()}).get(),p=r.height,f=0,m=0;m<h.length;m++){var g=h[m].toLocaleLowerCase();if(v=e.map(r.words,t(g)),0!==v.length){var v=v.sort(u)[0];p=Math.min(p,v[3]),f=Math.max(f,v[1])}}p==r.height&&0===f&&(p=0,f=Math.round(.2*r.height));var y=Math.max(0,p/r.height-.1),w=Math.min(1,Math.min(r.height,f/r.height+.1)),x=1/(w-y),L=MEDIA_URL+n+"/service/thumbnail/"+(c?c+"/":"")+o+"/"+s+"-"+WDL.Search.formatCoord(0)+","+WDL.Search.formatCoord(y)+"-"+WDL.Search.formatCoord(1)+","+WDL.Search.formatCoord(w)+".jpg",b=e("<img>");b.on("load",function(){l.empty(),l.siblings("a").clone().empty().append(b).appendTo(l);for(var i=0;i<h.length;i++){var a,n=h[i].toLocaleLowerCase();a=e.map(r.words,t(n));for(var o=0;o<a.length;o++){var s=a[o];if(!(s[1]>f||s[3]<p)){var c=s[3]/r.height,d=s[1]/r.height,u=s[0]/r.width,m=s[2]/r.width,g=Math.max(0,c-y-.01)*x,v=Math.min(1,d-y+.01)*x,w=Math.max(0,u-.01),L=Math.min(1,m-u+.03);e('<div class="highlighted">').css({top:WDL.Search.formatPercentage(g),bottom:WDL.Search.formatPercentage(1-v),left:WDL.Search.formatPercentage(w),width:WDL.Search.formatPercentage(L)}).insertAfter(b)}}}}),b.attr("src",L),a.attr("data-image-src",L),b.css("width",l.innerWidth()+"px")})})};e(".result .doc.file").each(C);var T=window.location.hash.match(/view=(list|gallery|map)/);T&&l.val([T[1]]).filter(":checked").trigger("click").trigger("change")}}),jQuery(function(e){"use strict";if(!(navigator.userAgent.toLowerCase().indexOf("mobile")>=0)){var t=e("#site-search input[type=search]");if(!(t.length<1)){var r=t.data("typeahead-url"),i=t.data("suggest-url");r&&i&&e.ajax({url:r,dataType:"script",cache:!0}).success(function(){var e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:i+"?q=%QUERY",filter:function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];t.push({title:i[0],count:i[1]})}return t}}});e.initialize(),t.typeahead({highlight:!0,minLength:2},{displayKey:"title",source:e.ttAdapter(),templates:{suggestion:function(e){var t=document.createElement("p"),r=document.createElement("span");return r.className="badge",r.appendChild(document.createTextNode(e.count)),t.appendChild(r),t.appendChild(document.createTextNode(e.title)),t.outerHTML}}})})}}}),function(e){"use strict";function t(){var e=i.parents(".media-container").first(),t=e.find("object").detach();navigator.userAgent.indexOf("MSIE")>=0&&t.attr("classid","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"),e.empty().append(t)}if(!e(document.body).is(".viewer-video,.viewer-audio"))return!1;var r=document.getElementById("player"),i=e(r);i.on("loadedmetadata",function(){r.videoWidth&&(r.width=r.videoWidth,r.height=r.videoHeight,r.videoWidth>r.parentNode.clientWidth&&e("#content-top").addClass("cinema-display"))}),e("#viewer img").on("click",function(){return r.paused?r.play():r.pause(),!1}),e("audio,video,source").on("error",function(){var e={currentSrc:r.currentSrc,readyState:r.readyState,networkState:r.networkState,currentTime:r.currentTime,duration:r.duration};null!==r.error&&(e.errorCode=r.error.code),Raven.captureMessage("HTML5 Media Error",{extra:e}),r.networkState==HTMLMediaElement.NETWORK_NO_SOURCE&&t()}),Modernizr.video||t()}(jQuery);
//# sourceMappingURL=common-bundle.min.js.map